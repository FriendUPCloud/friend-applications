
    <div class="SubModule">
    	 <listview uniqueid="courses_listview">
            <listviewhead>
                <listviewheading>
                    Courses
                </listviewheading>
                <listviewtoolbar>
                    <listviewbutton icon="plus-circle" onclick="w_add_course"></listviewbutton>
                </listviewtoolbar>
            </listviehead>
            <listviewheaders>
                <listviewheader width="50%" sortable="sortable" name="Coursename">Course name</listviewheader>
                <listviewheader width="40%" sortable="sortable" name="DateCreated">Date created</listviewheader>
                <listviewheader width="10%" name="Buttons" align="right">&nbsp;</listviewheader>
            </listviewheaders>
            <listviewrows onload="w_reload_courses">
            </listviewrows>
        </listview>
    </div>
     
    <script>
        Application.submodules.courses = {
            init()
            {
            	// Adding a new course
            	ccAddCallback( 'w_add_course', function( data )
            	{
            		let v = new View({
                       title: "Edit course",
                       width: 800,
                       height: 900
                    });

                    // Create a menu
                    let myMenu = [
                    {
                        name: 'File',
                        items: [
                            {
                                name: 'Save',
                                command: 'save',
                                scope: 'local'
                            },
                            {
                                name: 'Quit',
                                command: 'quit'
                            }
                        ]
                    }
                    ];

                    // Number of courses
                    let dId = document.querySelectorAll(
                        '.SubModule .HRow'
                    ).length

                    // Add the menu to the view window
                    v.setMenuItems( myMenu );
                    
                    let f = new File('Progdir:Templates/main.html');
                    f.onLoad = function( data ){
                        v.setContent( data, function(){         
                            v.sendMessage(
                                { 
                                    command: 'loadNewCourse',
                                    displayId: dId
                                } 
                            );
                        });
                    }
                    f.load();
            	} );
                
                ccAddCallback( 'w_reload_courses', function( listview )
                {
		            // Refreshing courses
		            let m = new Module( 'system' );
		            m.onExecuted = function( e, d )
		            {
		                if( e != 'ok' )
		                {
		                	listview.clearRows();
		                    ge( 'PanelMain' ).classList.remove( 'SectionLoading' );
		                    return;
		                }
		                
		                // Convert JSON response into something listview reads
		                let ls = JSON.parse( d );
		                let out = [];
		                for( let a = 0; a < ls.length; a++ )
		                {
		                	out.push( [ {
                    			Type: 'string',
                    			Value: '<picture type="icon" width="22px" height="22px" icon="star-half-full" border-size="2" shape="circle"></picture> &nbsp;' + ls[a].Name,
                    			OnClick: 'course_click_' + a
                        	}, {
                    			Type: 'string',
                    			Value: ls[a].DateCreated,
                    			OnClick: 'course_click_' + a
                        	},
                        	{
                    			Type: 'string',
                    			Align: 'right',
                    			Value: '<picture type="icon" width="22px" height="22px" icon="pencil-square" onclick="course_edit_' + a + '"></picture>',
                    			OnClick: 'course_click_' + a
                        	} ] );
                        	
                        	ccAddCallback( 'course_edit_' + a, function( element )
                        	{
                        		let listview = ccFactory.getElementByUniqueId( 'courses_listview' );
                        		if( listview )
                        		{
                        			console.log( 'Editing row..', listview );
                        		}
                        	} );
                        	
                        	( function( r )
                        	{
		                    	ccAddCallback( 'course_click_' + a, function( data )
		                    	{
		                    		let v = new View({
	                                   title: "Edit course",
	                                   width: 800,
	                                   height: 900
	                                });

	                                // Create a menu
	                                let myMenu = [
	                                {
	                                    name: 'File',
	                                    items: [
	                                        {
	                                            name: 'Save',
	                                            command: 'save',
	                                            scope: 'local'
	                                        },
	                                        {
	                                            name: 'Quit',
	                                            command: 'quit'
	                                        }
	                                    ]
	                                }
	                                ];
	                                // Add the menu to the view window
	                                v.setMenuItems( myMenu );
	                                
	                                let f = new File('Progdir:Templates/main.html');
	                                f.onLoad = function( data ){
	                                    v.setContent( data, function(){         
	                                        v.sendMessage(
	                                            { 
	                                                command: 'loadCourse',
	                                                courseId: r.ID
	                                            }
	                                        );
	                                    });
	                                }
	                                f.load();
		                    	} );
		                   	} )( ls[ a ] );
		                }
		                
		                listview.setRowData( out );
		                
		                ge( 'PanelMain' ).classList.remove( 'SectionLoading' );
		            }
		            m.execute( 'appmodule', {
		                appName: 'CourseCreator',
		                command: 'submodule',
		                vars: {
		                    method: 'courses',
		                    submodule: 'courses'
		                }
		            } );
		        } );
		        
		        ccInitializeGUI();
            }
        };
        Application.submodules.courses.init();
    </script>


